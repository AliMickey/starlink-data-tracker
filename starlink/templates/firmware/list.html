{% extends 'builders/base.html' %}

{% block title %}Starlink Firmware{% endblock %}

{% block scriptsHead %}
  <link href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css" rel="stylesheet">    
  <script>
    $(document).ready(function() {
        var table = $('#dataTable').DataTable({
            "searching": true,
            "ordering": true,
            "order": [0, "dsc"],
            "paging":  true,
            "pagingType": "simple",
            "lengthMenu": [ 10, 25, 50, 100 ],
            "info": true,
            "stateSave": false,
            buttons: [ 'copy', 'csv', 'excel' ]
        });
        $('#tableSearch').keyup(function(){ 
            var input = $(this).val();
            // Hide all rows
            $('#dataTable tbody tr').hide();
            // Show each row that contains the input
            var len = $('table tbody td:nth-child(1):contains("' + input + '")').length;
            if(len > 0){
            $('#dataTable tbody td:contains("' + input + '")').each(function(){
                $(this).closest('tr').show();
            });
            };
        });
    });
  </script> 
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-8 text-center">
    <p class="fs-1 fw-bold">{{ listType }} Firmware List</p>
      <table class="table table-striped table-bordered" id="dataTable">
      <thead>
        <tr>
          <th>Date Added</th>
          <th>Version</th>
          <th>Reddit</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><p hidden>9999-12-31</p></td>
          <form method="post" id="addVersionForm">
            <td><input type="text" class="form-control" id="version" name="version" maxLength="50" required></td>
            <td><input type="text" class="form-control" id="redditThread" name="redditThread" maxLength="500" required></td>
            <td><button type="submit" class="btn btn-primary float-start" name="btn" value="addVersion">Add</button></td>
          </form>
        </tr>
        {% for id, details in listDict.items() %}
        <tr>
          <td>{{ details['dateAdded'] }}</td>
          <td>{{ details['version'] }}</td>
          <td>
            {% if details['reddit'] %}
              <a href="{{ details['reddit'] }}" target="_blank"><img src="{{ url_for('static', filename='links/reddit.png') }}" width="40px"></a></td>
            {% else %}
              <p>There is no Reddit thread</p>
            {% endif %}
          <td>
            <div class="float-start">
              <a type="button" class="btn btn-primary position-relative" href="{{ url_for('firmware.notes', listType=listType|lower, entryID=id) }}" >Notes
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">{{ details['noteAmount'] }}</span>
              </a>
              <a type="button" class="btn btn-danger" href="#" data-bs-toggle="modal" data-bs-target="#removeVersionModal-{{id}}">Remove</a>
            </div>
          </td>
        </tr>
        <div class="modal fade" id="removeVersionModal-{{id}}" tabindex="-1" aria-labelledby="RemoveVersionModal" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addWebsiteLongTitle">Remove Version</h5>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to remove this version? This will also remove all related notes.</p>
                    <form method="post" id="removeVersionForm">
                        <input type="hidden" name="entryID" value={{id}}></input>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger" name="btn" value="removeVersion">Remove</button>
                        </div>
                    </form>
                </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}

{% block scriptsBody %}
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
{% endblock %}